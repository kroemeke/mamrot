# Mamrot

A Rust-based TCP/HTTP fuzzing and load-testing tool.

## Usage

```bash
cargo run --release -- --target <HOST> --port <PORT> [OPTIONS]
```

### Options

- `-t, --target <TARGET>`: Target host.
- `-p, --port <PORT>`: Target port (default: 80).
- `--headers <HEADERS>`: Path to headers file (default: headers.txt).
- `--wordlist <WORDLIST>`: Path to wordlist file (default: wordlist.txt).
- `--timeout <TIMEOUT>`: Request timeout in milliseconds (default: 1000).
- `-c, --concurrency <CONCURRENCY>`: Max concurrent connections (default: 128).
- `--seed-log <FILE>`: Path to the binary seed log file (default: seeds.bin).
- `--seed-buffer-size <SIZE>`: Number of seeds to keep in the ring buffer (default: 16,000,000).
- `--replay <SEED>`: Replay a specific batch using the provided 64-bit seed (prints to stdout).
- `--replay-file <FILE>`: Replay/Loop all seeds from a binary log file against the target.

## Reproducibility & Debugging

Mamrot logs the random seed used for every batch of requests to a binary ring buffer file (default `seeds.bin`). This allows you to replay the exact same sequence of requests if you detect a crash or anomaly on the target.

### inspecting the Seed Log

The seed log is a raw binary file containing 64-bit unsigned integers (u64). To read it, use the `od` command:

```bash
od -t u8 -A n -w8 -v seeds.bin
```

This will output one decimal seed per line.

### Checking Seed Usage

To check how many valid seeds are stored and calculate the ring buffer usage:

```bash
# Calculate usage
export FILE=seeds.bin
USED=$(od -t u8 -A n -w8 -v $FILE | grep -v "^\s*0$" | wc -l)
TOTAL=$(( $(stat -c %s $FILE) / 8 ))

echo "Usage: $USED / $TOTAL seeds ($((USED * 100 / TOTAL))%)"
```

### Replaying a Single Batch (Debug)

Once you have identified a seed (e.g., `67908340935210883`), you can replay that specific batch:

```bash
cargo run --release -- --target <HOST> --replay 67908340935210883
```

This will output the raw HTTP requests generated by that seed to stdout **without** sending them to the target.

### Replaying a Full Session (Regression)

To "loop" the fuzzing session using previously generated seeds (e.g., for regression testing a fix against a known crash scenario):

```bash
cargo run --release -- --target <HOST> --replay-file seeds.bin
```

This will:
1. Load all non-zero seeds from `seeds.bin`.
2. Disable new random seed generation and logging.
3. Infinitely loop through the loaded seeds, sending requests to the target.

### Bisecting a Crash (Advanced)

If you need to isolate a specific seed that causes a crash from a large `seeds.bin` file, you can split the file into smaller chunks.

**Important**: The file format relies on 8-byte alignment. You must split the file in multiples of 8 bytes.

Using `split` with power-of-2 sizes (like `1M`, `32M`) ensures alignment:

```bash
# Split into 64MB chunks
split -b 64M seeds.bin chunk_

# Replay the first chunk
cargo run --release -- --target <HOST> --replay-file chunk_aa
```

If `chunk_aa` causes the crash, split it further:

```bash
split -b 32M chunk_aa subchunk_
```

Repeat until you isolate the small set of seeds causing the issue.

